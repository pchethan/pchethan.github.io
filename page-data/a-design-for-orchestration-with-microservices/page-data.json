{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/a-design-for-orchestration-with-microservices","result":{"data":{"post":{"__typename":"MdxPost","slug":"/a-design-for-orchestration-with-microservices","title":"A Design for Orchestration with Microservices","date":"21.07.2020","tags":[{"name":"Design","slug":"design"},{"name":"Architecture","slug":"architecture"},{"name":"Orchestration","slug":"orchestration"},{"name":"Saga","slug":"saga"},{"name":"Centrum","slug":"centrum"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"A Design for Orchestration with Microservices\",\n  \"date\": \"2020-07-21T00:00:00.000Z\",\n  \"tags\": [\"Design\", \"Architecture\", \"Orchestration\", \"Saga\", \"Centrum\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This article describes the design of an application framework which helps in implementation of business procedures using orchestration with microservices. \"), mdx(\"p\", null, \"The design provides \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Data model, \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Programming model and \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A set of constraints \")), mdx(\"p\", null, \"which induce benefits listed at the end of this article.\"), mdx(\"h3\", null, \"Background\"), mdx(\"h4\", null, \"Business Procedure\"), mdx(\"p\", null, \"A business procedure is a tree of operations, that together, accomplish a business task.\"), mdx(\"p\", null, \"For example, in an e-commerce business, completing an order may invo\\xAD\\xADlve below operations and sub-operations\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Payment\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Credit cards, e-wallets\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Procurement from seller\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Shipping\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Packaging\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Email, SMS Verifications\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"349px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"83.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQ4y22Uaa7CMAyEc/9LcQGkAkIgxKbyg7LvlKUFP32Wpgp9tVQS4vF4YrsNRVFYWZYWr/Gz2+3sfD7bdru16/Vqn8+n8tXjWAM/gOKV5/v92u12s8PhYLPZzPb7vR2PR2vCx2sQQT0Tzsfj4QrX67UTQi6FTXEVoUCxQvav18uyLLPT6eSE7Ov4OO6HsL4C3Gw2vkfl+/225/PpapuSV4T1qxKIgybkeW4YtYOMulKG1WrlOP6zNjYFpwwCGqIzKQSHQYp6SMD8U8iG0eAZj8dOCFC+4XDopCqFknQ6Hb/Fj0ICIYKEw8Vi4QpEyH+CaQhdxiDhDD8NYz6lNABAfq/Xs9FoZNPp1C6XiwcCpF6tVsu63a4n1W36/b7HcM4EQOgKARBIdupGZhqgseF8uVz6OYnUGJp2v9+968SpjlVTcBBENkz1g5wAgnXGg3LOwaO4ImRDZmqBkVkKlUxToK6SXCOFcQsSYoHNYDColM3nc0vT9EdRPMiqH9eOu04MvqDrcF2yohCwPgYiwlCGGkjouqZBHxJ4ArNERjIAmEwm1m63veOaR5HgA5skiWNoJuWKrx80lCjibUApBjDuKjgIUBK/PdSbVYP9B6YeIi5rxqBDAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"optree\",\n    \"title\": \"optree\",\n    \"src\": \"/static/4493c03c5c3cdf946f8fbf284e078562/fe88b/optree.png\",\n    \"srcSet\": [\"/static/4493c03c5c3cdf946f8fbf284e078562/5243c/optree.png 240w\", \"/static/4493c03c5c3cdf946f8fbf284e078562/fe88b/optree.png 349w\"],\n    \"sizes\": \"(max-width: 349px) 100vw, 349px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Business Procedure\")), mdx(\"br\", null), mdx(\"p\", null, \"The tree could be of arbitrary depth. For example, payment processing may involve, applying coupon codes, promotions, discounts in addition to talking to external payment gateways, e-wallets etc.\"), mdx(\"h4\", null, \"Microservices\"), mdx(\"p\", null, \"A system could be split into microservices by any one of various decomposition methods. (Using bounded contexts of Domain Driven Design is one). Irrespective of the method, a microservice operates with one or few focused concerns.\"), mdx(\"p\", null, \"E.g., a separate microservice could be responsible for handling payments.\"), mdx(\"p\", null, \"So business procedures invariably span multiple microservices.\"), mdx(\"h4\", null, \"Orchestration\"), mdx(\"p\", null, \"'Orchestration' is an design where a single microservice (lets call it - 'owner'), takes responsibility executing a business procedure from start to end.  It does this by implementing an execution plan and progressing a 'cursor' on the plan and invoking services of other microservices wherever needed. That is -- the owner microservice acts as controller. \"), mdx(\"p\", null, \"Orchestration is a type of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://microservices.io/patterns/data/saga.html\"\n  }, \"'Saga'\")), mdx(\"p\", null, \"An execution plan creates a topology of microservices.\"), mdx(\"br\", null), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"479px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"56.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVQoz22SiaqDQAxF5/8/TgqCQkEUBVu3WrcqdcnjBAJW3sAlQ5ab3My4bdtkXVfBcpqmkSRJJE1TKYpC2raVz+cj0zRJ13Xyfr9lGAbNvwIedxyHgH3fNZFCghB9v1+Z51kJoyjSRnVdK6j5j9SN4yh930tVVWqXZVGbZZlaQBP8gCY0o44hIMHa3SEDstfrpcV0z/Nci5CPRJKvB0IaEbNmKhlJBCEiiBSCJCP1rICd0gQwKTYMQ60ty1LznXWHhGmvMqwJ+6UIEiyTP59Pud/vescPh7NlWhFdOPZYACmAGDkAZfg4Pzs8vxBOdgkoQipTY88klmtfxXy6QwsyCYfdIYWd8TAQneWfFZ3x8w/tYQxMhGUnVzIsD0JjA7n4iDk+axAE4nme3G43tYB/yPIfj4eCqbG8dBzHmmsg3/d9jf8Bby5Pe3OqmpUAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"topology\",\n    \"title\": \"topology\",\n    \"src\": \"/static/8969c18cd10f47203e7fa5406175564f/26ccf/topology.png\",\n    \"srcSet\": [\"/static/8969c18cd10f47203e7fa5406175564f/5243c/topology.png 240w\", \"/static/8969c18cd10f47203e7fa5406175564f/26ccf/topology.png 479w\"],\n    \"sizes\": \"(max-width: 479px) 100vw, 479px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Execution Topology\")), mdx(\"br\", null), mdx(\"p\", null, \"Execution of procedure could look like this:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"338px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"142.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD20lEQVQ4y4VVaW+jVhT1//8RI3VG6lTqh26K2nzozCRKM5MZx3aIMauNMdjYYJbHYngrvTxix6nS1kIgX+5y7jn3PgZoPg7Vr0y0rDpEs7/2tonsUagPKRWsrPazm9g2E2sYmY9t2zb73V69jud2YtyBZeBOL4Yf3pZlzYtC+fL24ePvW/Nycv2+RDXLkTX5Xr2+9PQL5eZnTtty4+ij77SrD8bkx4frnwaRbSyVBw5pOfenk7Vlh6Zhj+8ZBzDMHQ+DxSK0DUdRwIUUxfzudrfyNrPpUp0OWi6iXWSoM2/p8gNg5YIyuLfyxzFthRCcc8KeLA3t7qTzGYDrZjzbOqvU8XPN6Twx4ZQeXbHgAnwYJr2F1Y1MCj5sAI9qsXbmC32mZeEegLAan4LZoYF0XXCDewut6s7eEE5oB5tQluYoy3NIBgg75PwIm5xgH7FICFy21gWvdHs6foi3ISsOBJXF3D+5/k9lyJSM9NhdR65frkO8zwrLA6NoheyZdJUZ58894x4RZBzAC1IclivXmttVUYArP2f7v4PhARhOrl0kpoHna7PZPtoLgA0Nn8Fmh/rINoXKTMgORV8TyCI09bcgXuaskbroXknxXyFMVsanyuDUa9hbyKFeOI76oESboGOrbnCCJGG4IwwqP8sg8533XO+ScKylq02xCkhWFLYHVz95EDjgstQJEnQI8iDNKVNUoeKwSygqWzl2r03Yi2DaEwsBc8s2NB3t4x7RE6mipYez4Bew5bjDlaSpv1kXVdlSLqRUrFP+pVSM/YMw3BHWkK29tBU1C8ImTOpdnCl2H3M2YSfCjmsg5GyfEdYvCWsZ3+52ummmccwrCZs+Vyb/JtUTPTX2Pz9s5stoahfmqgcvK8tdFR0XshNgu8aVG4CREUqLSsj7wd1K0Jz2E/Y02/SMMMk29FOtQ2U8mdyP0iBsZfaul3PC8HExCoSiOM5yJCSHfdaXi9Gx+IrOsM++ZpmKGno+yysYI5zmOC1oXgFaHCPQvDfSUlqSnMDRAQcWFwNImdxra8txdSvzAnjRRCmOMzgVCKqaXQKJYJ5BM9KlLsECuepgL7eKwEixXRSug01TNgAE/grKn8/Kfp+b49lSy62SPoPSN5K5Cr6iwWippKtl6emJo8Gm8rpG8wnyVkVnMSEGZwlajJHv566auvZg9fjb5OO76oBZnj/evpl++mMzu1Cu31d5wzJkDt/Nri499Vf15hfO2tJf6N/e6Fd/GsMfHuGLERiP2t0NTApI4ky+ODN1a6ra11sK2hCyGH12NS0wpuZ42H2rUGbcffIty1NH1uT+bwMvcCLKWJz4AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"callseq\",\n    \"title\": \"callseq\",\n    \"src\": \"/static/7ff56cce8847040a89579be77684b74d/7264e/callseq.png\",\n    \"srcSet\": [\"/static/7ff56cce8847040a89579be77684b74d/5243c/callseq.png 240w\", \"/static/7ff56cce8847040a89579be77684b74d/7264e/callseq.png 338w\"],\n    \"sizes\": \"(max-width: 338px) 100vw, 338px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Call Sequence\")), mdx(\"p\", null, \"Note: the calls could be HTTP calls or events.\"), mdx(\"h5\", null, \"Intra-microservice Orchestration\"), mdx(\"p\", null, \"If a microservice is organized into modules or layers with clear boundaries, there could be orchestration within microservices too.\"), mdx(\"h5\", null, \"Consolidated Orchestration View\"), mdx(\"p\", null, \"A view of intra and inter microservices orchestration is depicted in diagram below.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"651px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"70.83333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQ4y3WTiQqEMAxE+/8fqYiioHjhfXZ5gZHu4gqxTZNMkknrzvP0b3Jd1+vZvu/+OA5fFIVPksRnWeaXZbFzfJyc5fhPl6zraoJtnmffdZ0lQifGAKXkee6jKPJpmpqzskoEUpalrXzTNPlhGAx02zbvcCLjfd8GQEb0sFK1SzBA+I7jaL7otMyZAfIDgENxgfR9/zgBho1KKICPlTOSqAADJJhAnJumMYOCVTl7AtUWPnzYqBDRuVXIBzBBZEbYUyXO4kg0EKOhIegaoAEqEwDKTgA2cQagQOmA68Lwqqr64tyFGQARn6wQT6XiVwPEj0SA1XX9UIHdaZK/VyS8cxJaB6BtW9MBIqnAbCi6EuJDlYqjsFXxzV7Vk4Q9tJDEiSdaCsl9e3rhhPEHiDW0W4UMI45jE1oi29u7FlfYVSmxVPq8ZUqGXB46T08t/7auVQ+BVR1pUMgH02RFvZoPFmsAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"orchestrationview\",\n    \"title\": \"orchestrationview\",\n    \"src\": \"/static/c5a57abaa717b081715334a5c1f4a7e6/6150a/orchestrationview.png\",\n    \"srcSet\": [\"/static/c5a57abaa717b081715334a5c1f4a7e6/5243c/orchestrationview.png 240w\", \"/static/c5a57abaa717b081715334a5c1f4a7e6/ab158/orchestrationview.png 480w\", \"/static/c5a57abaa717b081715334a5c1f4a7e6/6150a/orchestrationview.png 651w\"],\n    \"sizes\": \"(max-width: 651px) 100vw, 651px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Op Tree\")), mdx(\"p\", null, \"Each rectangle within a microservice could be an \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Aggregate\"), \" (DDD). \"), mdx(\"p\", null, \"So, a logical view of 'op tree' does not have microservices boundaries.\"), mdx(\"h3\", null, \"Design\"), mdx(\"h4\", null, \"Data Model\"), mdx(\"p\", null, \"So, to recall, a business procedure is modelled as a tree of operations (Fig: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Op tree\"), \") that may span within and across microservices. An 'operation' is a unit of work.\"), mdx(\"p\", null, \"Running a procedure generates data. 'Operation Data' (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Op data\"), \") is the data created by each operation during a run.\"), mdx(\"p\", null, \"This design proposes an 'Operation Data Tree' (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Op data tree\"), \") - A tree of op data created with the same structure as op tree. One op data tree is created for every procedure run.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"831px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"42.083333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9UlEQVQoz42SyQqEQAxE+///zZNeFdwQd3HfM7xAiwwMzCG0SVUqlaA5z1NsbNsm79zGfd8/seu6FOM9jkOMbRiGQeI4fsDvhjRNlQP3Pei7TwXneZZpmqRtWyUsy/KIQgQnxnGUdV0fQXgWox+u6bpOkiSRvu8lCAIVjaJI7eOgKAoVqutaX3JEwbMsU7E8z1XMcRwxOKqqSgkUyRlCE9E0zeOMZjDc4QiMGpgdasIwVIdlWSrJ930FEafGMAIRtqBp33d1Rx1RNoELbrgDExDAJRPtuv/8AXYz+23ehyVsjluCb87geZ7eF9xiGOGmruvqVnA/ompql8NFPsAAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"datamodel\",\n    \"title\": \"datamodel\",\n    \"src\": \"/static/339e8cb18d978ae31cb5b3fc30f0348e/986c4/datamodel.png\",\n    \"srcSet\": [\"/static/339e8cb18d978ae31cb5b3fc30f0348e/5243c/datamodel.png 240w\", \"/static/339e8cb18d978ae31cb5b3fc30f0348e/ab158/datamodel.png 480w\", \"/static/339e8cb18d978ae31cb5b3fc30f0348e/986c4/datamodel.png 831w\"],\n    \"sizes\": \"(max-width: 831px) 100vw, 831px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Op Data Tree\")), mdx(\"p\", null, \"While op data differs for every type of operation, below common attributes are prescribed\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Unique operation invocation identifier.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"State (InProgress, Failed, Success, Expired)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Parent operation invocation identifier\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Child operation invocation identifiers\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Root operation invocation identifier\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Error (Details with specific error id and message)\")), mdx(\"p\", null, \"When we have op data tree, there is no need for a separate state machine. The tree itself serves as a consolidated state or the 'cursor' for the business procedure. This is so much better than having a separate state machine in each microservice.\"), mdx(\"p\", null, \"This op data tree is contained within the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"owner\"), \". Owner can collect op data including updates during op lifecycles from within or other microservices using eventing solutions like Kafka.\"), mdx(\"h4\", null, \"Microservice API Model\"), mdx(\"p\", null, \"To effectively implement orchestration, we define following API model.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"APIs must allow callers to set a timeout period, beyond which a callee ceases to continue with any further actions associated with the API.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"APIs must succeed or fail within timeout period. Else, they are considered to be 'expired'\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This is inline with states of op data (see above).\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"If required by callers, a microservice must provide an API to reverse a performed action. Also called as \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://microservices.io/patterns/data/saga.html\"\n  }, \"compensating\"), \" actions.\")), mdx(\"h4\", null, \"Op Manager\"), mdx(\"p\", null, \"An operation manager is an entity which performs actions associated with an operation. A framework creates this manager as soon as someone creates an op data and requests initiation by dispatching an event.\"), mdx(\"p\", null, \"A unique op manager type exists for every unique op data type. For e.g.,'SendOTPData' op data (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"OD\"), \") class is associated with 'SendOTPManager' class.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It manages the life-cycle of an operation.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It reads and writes to op data it is associated with\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It performs any number of local actions such as calling other internal APIs, etc.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It invokes at most one external API. (If more than one API needs to be called, the operation must be split into multiple)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It can delegate by creating any number of child operations.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It enforces timeout period.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It concludes result of operation as success/failure/expired.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It notifies manager of parent operation with result, as an event.\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"626px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"56.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVQoz12S63KbMBCFef/XaX96WjttZlqnieNbSLBrK2Ab1wYqJO4gTlZycGh3ZgeExKfds8cCRa1aiFeG4OEeeZrqT1CqQdM0qKoKSZKYNeccNa2VUmavqevLs5fWlE3we79GmqTI8wzBKcRy7CBLcrStQlGW2DCGWEowz0PZATWsbS/ZBy7cGQJxQhRGOJ1PBrSaMWSSgFRpSaCQbdHGMZLDATV1oDqQEKhFjKarWAOpDHNjS8+WWm+otcu7giJgRrB49AXrz5/AR1/BX55NlSW1f74ZIvh+g6YorlCrX27d06SgQ4K0S/0Dgrsxwukj5HwK4bmXtimF/QT5bP+jpfW/qBqqK9wf9nDdVwhqK80yMyhJF+i1R1oKkkKHqcxo+g407aoPYXXkWW4OaF1933+fukJK+jGSQJBuOvXQOjfofZ1WUeUQOb8CwzhERClzSZONDUxXre2iI5EJ4kiQvUgSLmmPYNoNaYmqqGCt/zgY2SSuPIFnfzFmPzBaDHHrfMM23BjI+XyG4ziomxrHbYD5rYNfwyle7hhElJAzCix/ruBMGKwj97HYzZGVKZIigX18wuNmgpk7xZ7vDJCRDweDAXmyQHQU2Mw92A8ruLYPyVMUWYnt0sNudYSlB6AN19eRTGPa6AaktQuC4OoC1SjzT6dd27PeG4VtSd5TaOsGAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"opmanagerlifecycle\",\n    \"title\": \"opmanagerlifecycle\",\n    \"src\": \"/static/763c96576c8c1afd87a45c597bd46a91/2c45b/opmanagerlifecycle.png\",\n    \"srcSet\": [\"/static/763c96576c8c1afd87a45c597bd46a91/5243c/opmanagerlifecycle.png 240w\", \"/static/763c96576c8c1afd87a45c597bd46a91/ab158/opmanagerlifecycle.png 480w\", \"/static/763c96576c8c1afd87a45c597bd46a91/2c45b/opmanagerlifecycle.png 626w\"],\n    \"sizes\": \"(max-width: 626px) 100vw, 626px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Op Manager working with its op data and other op managers, life cycle event propagation\")), mdx(\"br\", null), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"782px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50.83333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz31S227TQBD1/38PbwgeiBCIJGrTEqI4aUwTt669vqwve/Xah1lbQVAqRhp5vLMze86ZCYZhwGsfyZVxWO+esNxekHMFOsRbd197cA3c4P5KYBzp6yBFB9G1sNbCOff/hpQP3kr4wrIsYbRGUdX4cTijdwOsMej7/p+7U+wBkAf+wKO7Jrz5oowxaK1Q8gbHuEQnNIyx0OQ+P04M5vuO/h095j2QRmC9X+Lz3QJp9UL0hGdLaOzUsBOSCqnYGWjBIdsKHUmgfANqWNU1eBQh/PgByfLbjLAVDeqOQ8gOec6wu2wRs8v0es1i8DxBxyKcbt4jP37B6DRe1isUpwfkJI0ina2UcCTR1LC3PQ0BpJlB27ZgVYZWNlNDzfZQWYjZSJaedHQ9ZFFANjUNi+i6PzT0evgJWmtg7Cz6SBSV0rAUe3usWyzCIzZJCks5TUis13wccDU/4WnKkqBqo5DGDJuvWxy//6RVUVCkn6IcJ0r7JMHqHGPHcgilUHM+MYlOCRafbnF7cyQg81CD3eqA7JkhTTOcowsa3k2L3RKKd+EDwqdnYupmGCTL/SbC4fCIqirRNAJZVlDc/F6jX0NiArz/mlndAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"opmanager\",\n    \"title\": \"opmanager\",\n    \"src\": \"/static/ccae4241ab013a8c4991c148ed1ff237/30be2/opmanager.png\",\n    \"srcSet\": [\"/static/ccae4241ab013a8c4991c148ed1ff237/5243c/opmanager.png 240w\", \"/static/ccae4241ab013a8c4991c148ed1ff237/ab158/opmanager.png 480w\", \"/static/ccae4241ab013a8c4991c148ed1ff237/30be2/opmanager.png 782w\"],\n    \"sizes\": \"(max-width: 782px) 100vw, 782px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Execution view of an orchestrated business procedure\")), mdx(\"h4\", null, \"Op Manager Registry\"), mdx(\"p\", null, \"An application must register its op managers with the framework so that as soon as an op data of type 'X' is created and initiated, the framework looks up the registry, finds the corresponding manager and instantiates it.\"), mdx(\"h4\", null, \"Op Manager - Op Data; Reduced coupling\"), mdx(\"p\", null, \"Op manager of A creates op-data for sub-operation B. This means that op manager has knowledge of Op-data B and not the op manager B. \"), mdx(\"p\", null, \"This is because the structure of Op-data is standarized and the operation name itself would be a string. Only the input parameters different from operation to operation. This input param is stored as a serialized string. \"), mdx(\"p\", null, \"So, the only coupling of Op Manager A is with the input data for B, which can be documented and published by author of B. \"), mdx(\"p\", null, \"This has far less coupling compared to A being aware of B's constructors and other semantics.\"), mdx(\"h4\", null, \"Putting it all together\"), mdx(\"p\", null, \"An op tree is executed as follows.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Op data for top level operation is created in database. Say OD-1.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"OD-1 is initiated.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"An op manager which can handle such op data is looked up from registry and created.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"This op manager does these things\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Optionally, it invokes one or more local service APIs\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Optionally, it invokes an external API and gets result (Success/Failure/Expiry). This alone may determine the result of this operation or it may be preceded by, succeeded by or sandwiched in-between one or more child operations.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"It runs child operations (if any) sequentially. That is it creates and initiates a child OD and waits for result from its OM before proceeding to next child operation.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"It can run child operations in parallel as well.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"It responds to failure of child operations by creating yet another child operation dedicated for reversing any previous operation(s) (if the operation is transactional in nature).\")), mdx(\"p\", null, \"This is recursively applied to each and every operation.\"), mdx(\"h4\", null, \"Programming Model (Java)\"), mdx(\"p\", null, \"This design proposes a programming model to implement an op manager and child receptors with the use of class and nested classes as shown below.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"423px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"102.50000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQ4y32U12pDQQxE9/9/zC9+MLhhXLnuvV33onAUxihOHIHYph2Nym56Pp+23+9tPp/bcrm0YrForVbLjsejjcdjW61Wlue59Xo9Xx8OB7vdbna/3//U9Hg8/PJ2u3Xgfr/v4OxtNhsHOJ/Ptl6vfZ5lmdsg3I3qgELm0uVy8fn1erXT6eRMiABjBBtYdrtdGwwGzhwiUs5TpC8v0Ws8xyGsF4uFg7EWEQgQRfqUi3cVS1JBapDIvtPpWKlU+gbUwX8KA5TQKB7MlBbOZ7OZFzORL7xyKKOo7FEMwmTNHGVO+IwQQkhDgj7GxD8cDm0ymdh0OvVROhqNHAQWzWbT6vW6txPssAWD+7BPags8wRRvOIjV4zJhqpVYM9/tds5KxWNMCkFKTrnAiBFKWriMUxgRCXOYvTe5A+INFSAsYrOqkohyLpHNR0All9DlHRAaWTnlpZBP2JKuCPoDECDCaTQar3wKsFqtWrlc9qLUarXXmyf0X4ACJfFUsFAoODAilrxvHOq5qTsEJLtXlcVEryHmh5aACcIzA1R2nGGnaBKbVJUw+aIAlREgfAaAqEhqI70ubMircpnUW5VKxd8jhlwCmJA4E2M5xyEAKiBrlLATB1yOX5bahjzqs2UNU74uRYJzUtZut70LPGQu0AYkOb4UPDPSHgjGCOwpkHoSYc0+ktQKsKPKAHOotwkwrwTVmcKNH6+i8CrToADACG+MUq3jSB6jsgco0X0Bq/1SWvaBMz0AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"opmanagerlifecycle2\",\n    \"title\": \"opmanagerlifecycle2\",\n    \"src\": \"/static/d6a93b5a41183c5d0d1f693ba7d58c42/7e2cd/opmanagerlifecycle2.png\",\n    \"srcSet\": [\"/static/d6a93b5a41183c5d0d1f693ba7d58c42/5243c/opmanagerlifecycle2.png 240w\", \"/static/d6a93b5a41183c5d0d1f693ba7d58c42/7e2cd/opmanagerlifecycle2.png 423w\"],\n    \"sizes\": \"(max-width: 423px) 100vw, 423px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig:Life-cycle event flows with op manager\")), mdx(\"p\", null, \"Diagram below shows a model of a class which implements an operation manager.\"), mdx(\"p\", null, \"At a high level, it has the two sections\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Part which handles the invocation and handling of responses of internal or external API calls.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Child operation event handlers.\")), mdx(\"p\", null, \"Although the child receptors can be created in a separate class, putting them in a static inner class provides a unified view of the operation manager in a single place. This is especially the case since most of the meat of the operation activity is in the details of how it handles child life cycle events.\"), mdx(\"p\", null, \"The inner class also depicts the parent-child relationship and helps comprehend an operation manager in a much easier way.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"251px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"183.75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,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')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"programmingmodel\",\n    \"title\": \"programmingmodel\",\n    \"src\": \"/static/c59bd519b9016066ad6341499b5ae036/fe9a0/programmingmodel.png\",\n    \"srcSet\": [\"/static/c59bd519b9016066ad6341499b5ae036/5243c/programmingmodel.png 240w\", \"/static/c59bd519b9016066ad6341499b5ae036/fe9a0/programmingmodel.png 251w\"],\n    \"sizes\": \"(max-width: 251px) 100vw, 251px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Fig: Programming Model\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  })))), mdx(\"h4\", null, \"Examples\"), mdx(\"h5\", null, \"'One Time Password' Example\"), mdx(\"p\", null, \"Requirement: There are two ways to send OTP to user - via SMS and/or Email. Sending OTP over email if sending over SMS fails. Do not send OTP over email if mobile number is invalid.\"), mdx(\"p\", null, \"It begins with some part of the system initiating OneTimePasswordConfirmationManager. onInitiate() is chartered to do the work of a sending OTP. It first creates a child operation PurchaseOTPNotifierOverSMS and schedules it. The input parameters for sending SMS are put into the operation before initiating.\"), mdx(\"p\", null, \"The op manager associated with PurchaseOTPNotifierOverSMS does what it is supposed to do and conveys the success/failure/expiry to a dedicated handler setup by OTPNotifierOverSMSChildHandler.\"), mdx(\"p\", null, \"If sending SMS fails, sending email is attempted. If the reason for SMS failure was an 'Invalid number', the op data is marked as failed immediately.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"    public class OneTimePasswordConfirmationManager implements IOperationManager {\\n        @Override\\n        public void onInitiate() throws Exception {\\n            //create otpNotifierOverSMSData\\n            // otpNotifierOverSMSData.setInputData(MSISDN, ...)\\n            // otpNotifierOverSMSData.setExpiry()\\n            //SchedulerHelper.schedule(otpNotifierOverSMSData, expiry)\\n        }\\n        @Override\\n        public void successResult(ErrorDetails result) throws Exception {\\n            //This is called after an operation is successful\\n            //Update db fields, cleanup of resources etc.\\n        }\\n        @Override\\n        public void failureResult(ErrorDetails result) throws Exception {\\n            //This is called after a op has failed\\n            //Update db fields, cleanup of resources etc.    \\n        }\\n        @Override\\n        public void validityEnded() throws Exception {\\n            //This is called after a op has expired\\n            //Update db fields, cleanup of resources etc.\\n        }\\n        @Override\\n        public void handleEvent(Result res) throws Exception {\\n            //A result of an operation done in handleTxnInitiate is delivered to this manager \\n            //e.g., callback, a message from message queue etc.\\n            //Based on contents, op manager can mark itself as successful/failed\\n        }\\n    \\n        List<ChildOperationEventHandler> getChildLifeCycleHandler(String opType) {\\n            //return dedicated \\n            //return OTPNotifierOverSMSChildHandler and OTPNotifierOverEmailHandler\\n        }\\n    \\n    \\n        private class OTPNotifierOverSMSChildHandler implements ChildLifeCycleHandler {\\n            @Override\\n            public void onChildTxnSuccess(Operation op, Operation childOperation) throws Exception {\\n                //markSelfAsSuccess(Operation, result(childOperation.getOutputData()));\\n            }\\n            @Override\\n            public void onChildTxnFailed(Operation op, Operation childOperation) throws Exception {\\n                //result = childOperation.getOutputData()\\n                //if result says that MSISDN is invalid, flag as invalid account. Else try email\\n                //if(result.error!=Error.INVALID_MSISDN) { //Say, we don't want to have accounts with invalid number\\n                tryEmail(Operation, childOperation);\\n                //} else {\\n                //op.setOutputData(Error.InvalidNumber,...)\\n                //markSelfAsFailed(Operation);\\n                //}\\n            }\\n            @Override\\n            public void onChildOpExpired(Operation op, Operation childOperation) throws Exception {\\n                tryEmail(op, childOperation);\\n            }\\n            private void tryEmail(Operation op, Operation childOperation) {\\n                //create purchaseOTPNotifierOverEmail\\n                //otpNotifierOverEmail.setInputData(email, ...)\\n                //otpNotifierOverEmail.setExpiry()\\n                //SchedulerHelper.schedule(purchaseOTPNotifierOverEmail, expiry)\\n            }\\n        }\\n    \\n    \\n        private class OTPNotifierOverEmailHandler implements ChildOperationEventHandler {\\n            @Override\\n            public void onChildOpSuccess(Operation op, Operation childOperation) throws Exception {\\n            //...\\n            }\\n            @Override\\n            public void onChildOpFailed(Operation op, Operation childOperation) throws Exception {\\n            //...\\n            }\\n            @Override\\n            public void onChildOpExpired(Operation op, Operation childOperation) throws Exception {\\n            //...\\n            }\\n        }\\n    }\\n\")), mdx(\"h5\", null, \"Order Failure Example\"), mdx(\"p\", null, \"An e-commerce order example. Wallet credit is reversed when delivery scheduler returns with error.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"    public class OrderManager implements IOperationManager {\\n      @Override\\n      public void onInitiate() throws Exception {\\n        //create WalletCreditOp\\n        //walletCreditOp.setInputData(amount, ...)\\n        //walletCreditOp.setExpiry()\\n        //SchedulerHelper.schedule(walletCreditOp, expiry)\\n      }\\n      @Override\\n      public void successResult(ErrorDetails result) throws Exception {\\n        //This is called after an op is successful\\n        //Update db fields, cleanup of resources etc.\\n      }\\n      @Override\\n      public void failureResult(ErrorDetails result) throws Exception {\\n        //This is called after an op has failed\\n        //Update db fields, cleanup of resources etc.\\n      }\\n      @Override\\n      public void validityEnded() throws Exception {\\n        //This is called after an op has expired\\n        //Update db fields, cleanup of resources etc.\\n      }\\n      @Override\\n      public void handleEvent(Event e) throws Exception {\\n        //A result of an operation done in handleOpInitiate is delivered to this manager\\n        //e.g., callback, a message from message queue etc.\\n        //Based on contents, op manager can mark itself as successful/failed\\n      }\\n      List<ChildLifeCycleHandler> getChildLifeCycleHandler(String opType) {\\n        //return dedicated\\n        //return WalletCreditChildHandler and DeliveryChildHandler\\n      }\\n      private class WalletCreditChildHandler implements ChildLifeCycleHandler {\\n        @Override\\n        public void onChildOpSuccess(Operation op, Operation childOperation) throws Exception {\\n          //create ScheduleDeliveryOp\\n          //scheduleDeliveryOp.setInputData(amount, ...)\\n          //scheduleDeliveryOp.setExpiry()\\n          //SchedulerHelper.schedule(scheduleDeliveryOp, expiry)\\n        }\\n        @Override\\n        public void onChildOpFailed(Operation op, Operation childOperation) throws Exception {\\n          //markSelfAsFailed(op);\\n        }\\n        @Override\\n        public void onChildOpExpired(Operation op, Operation childOperation) throws Exception {\\n          //markSelfAsExpired(op);\\n        }\\n      }\\n      private class ScheduleDeliveryChildHandler implements ChildLifeCycleHandler {\\n        @Override\\n        public void onChildOpSuccess(Operation Operation, Operation childOperation) throws Exception {\\n        //...\\n        }\\n        @Override\\n        public void onChildOpFailed(Operation op, Operation childOperation) throws Exception {\\n          //delivery not possible to this address\\n          //create ReverseWalletOp\\n          //reverseWalletOp.setInputData(amount, ...)\\n          //reverseWalletOp.setExpiry()\\n          //SchedulerHelper.schedule(reverseWalletOp, expiry)\\n        }\\n        @Override\\n        public void onChildOpExpired(Operation Operation, Operation childOperation) throws Exception {\\n          //Retry: Create another ScheduleDeliveryOp until max attempts\\n        }\\n      }\\n      private class ReverseWalletCreditChildHandler { }\\n    }\\n\")), mdx(\"h3\", null, \"Design Benefits\"), mdx(\"p\", null, \"Overall the design provides below benefits.\"), mdx(\"h4\", null, \"Evolvability\"), mdx(\"p\", null, \"This design allows high evolvability between parent and child operations, due to below factors\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Ops are composable\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Op tree can be constructed dynamically\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Reduced coupling between op manager and op-data of other ops.\")), mdx(\"p\", null, \"The OTP example is a good illustration of this benefit.\"), mdx(\"h4\", null, \"Reliability\"), mdx(\"p\", null, \"Since APIs have timeout, caller and callee can be resilient to crashes, communication disruptions, planned/unplanned down times.\"), mdx(\"p\", null, \"Caller can identify an unresponsive API predictably, and recover from there.\"), mdx(\"p\", null, \"Implementation of callee becomes simple due to the fact that it does not have to deal with slow progressing or dead-locked operations since it can fail such operations at timeout and avoiding long running APIs and pile up of operations.\"), mdx(\"p\", null, \"Error resilience is baked into the system and can be easily enforced, through static code scans.\"), mdx(\"h4\", null, \"Extensibility\"), mdx(\"p\", null, \"Highly extensible.\"), mdx(\"p\", null, \"New op data and op managers can be added to system which can enable new functionalities.\"), mdx(\"h4\", null, \"Simplicity\"), mdx(\"p\", null, \"The procedure model, API model and programming model are all close to domain model and are applied recursively across the whole system.\"), mdx(\"p\", null, \"With the same design pattern repeated through out, there is lesser cognitive load for developers.\"), mdx(\"p\", null, \"Also, with op data and op managers confined to a smaller concern, complexity is reduced.\"), mdx(\"h4\", null, \"Reusability\"), mdx(\"p\", null, \"Op data and op managers are highly reusable. They can be used in combinatorial fashion like Lego bricks.\"), mdx(\"h4\", null, \"Visibility\"), mdx(\"p\", null, \"The Op Tree provides high visibility into the complete structure, progress and data of business procedures.\"), mdx(\"p\", null, \"Op tree has the additional benefit of being presentable in UI, since it has several common data attributes.\"), mdx(\"p\", null, \"Once available in UI --\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Business teams would be able look at the Op Tree and easily comprehend everything, after all, the op data tree closely matches business process.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Development teams would be able to look at the current in-progress operations as well as the detailed errors of individual failed operations.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Support teams would be able to look at the tree and point to specific operations\")), mdx(\"h3\", null, \"External References\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://vasters.com/archive/Sagas.html\"\n  }, \"https://vasters.com/archive/Sagas.html\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://microservices.io/patterns/data/saga.html\"\n  }, \"https://microservices.io/patterns/data/saga.html\"))));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"This article describes the design of an application framework which helps in implementation of business procedures using orchestration with…","timeToRead":7,"banner":null}},"pageContext":{"slug":"/a-design-for-orchestration-with-microservices","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}